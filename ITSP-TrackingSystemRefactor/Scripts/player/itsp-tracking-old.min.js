var fixedtime = "0",
    iscomplete = !1,
    startDate = new Date().getTime();
function getp(e) {
    return decodeURIComponent((new RegExp("[?|&]" + e + "=([^&;]+?)(&|#|;|$)").exec(location.search) || [, ""])[1].replace(/\+/g, "%20")) || null;
}
function StoreProgressStatus(e) {
    if (0 !== startDate) {
        var t = new Date().getTime();
        fixedtime = (t - startDate) / 6e4;
    }
    if (null != CCPlayer.TutorialID)
        var o = {
            action: "StoreASPProgressV2",
            TutorialStatus: e,
            TutorialTime: fixedtime,
            ProgressID: CCPlayer.ProgressID,
            CandidateID: CCPlayer.CandidateID,
            Version: CCPlayer.Version,
            CustomisationID: CCPlayer.CustomisationID,
            TutorialID: CCPlayer.TutorialID,
        };
    else o = { action: "StoreASPProgressNoSession", TutorialStatus: e, TutorialTime: fixedtime, ProgressID: CCPlayer.ProgressID, CandidateID: CCPlayer.CandidateID, Version: CCPlayer.Version, CustomisationID: CCPlayer.CustomisationID };
    $.ajax({ type: "POST", url: CCPlayer.TrackURL, data: o, dataType: String });
}
!(function (e) {
    e.preload = function () {
        for (var t = "[object Array]" === Object.prototype.toString.call(arguments[0]) ? arguments[0] : arguments, o = [], s = t.length; s--; ) o.push(e("<img />").attr("src", t[s]));
    };
})(jQuery),
    (function (e, t, o) {
        if (
            ((e.IsTracked = !0),
            (e.CustomisationID = getp("CustomisationID")),
            (e.ContentType = getp("type")),
            (e.Version = getp("Version")),
            (e.SectionID = getp("SectionID")),
            (e.CandidateID = getp("CandidateID")),
            (e.ProgressID = getp("ProgressID")),
            (e.TutorialID = getp("TutorialID")),
            (e.PLAThresh = getp("plathresh")),
            (e.TrackURL = getp("TrackURL")),
            (e.myscore = 0),
            (e.wrongcount = 0),
            (e.SelectionEnd = 0),
            (e.SelectionStart = 0),
            null == e.TrackURL && (e.TrackURL = "https://www.itskills.nhs.uk/tracking/tracker.aspx"),
            void 0 === e.CustomisationID && ((e.IsTracked = !1), (e.CustomisationID = "1"), (e.ContentType = "learn"), (e.Version = "2"), (e.SectionID = "3"), (e.CandidateID = "4"), (e.ProgressID = "5"), (e.PLAThresh = "85")),
            (e.MarkLearningComplete = function () {
                !0 === e.IsTracked ? ((iscomplete = !0), StoreProgressStatus("2")) : alert("Learning complete");
            }),
            (e.CloseLearning = function () {
                !0 === e.IsTracked ? (!1 === iscomplete && StoreProgressStatus("1"), window.parent.closeMpe()) : (alert("Close learning"), (window.opener = window.self), window.close());
            }),
            (e.UpdateAssessmentScore = function (o, s) {
                e.AssessAttempted = !0;
                var r = !1;
                t.each(e.objson, function (e, t) {
                    t.tutorialid == o && (s > 0 ? (t.myscore = t.myscore + s) : (GETTUTORIALLISTFORPLt.wrongcount = t.wrongcount + 1), (r = !0));
                    t.tutorialid == o && (s > 0 ? (t.myscore = t.myscore + s) : (t.wrongcount = t.wrongcount + 1), (r = !0));
                }),
                    0 == r && (s > 0 ? (e.myscore = e.myscore + s) : (e.wrongcount = e.wrongcount + 1));
            }),
            (e.SubmitDiagnosticOutcome = function () {
                if ("diag" === e.ContentType && !0 === e.AssessAttempted) {
                    var o = JSON.stringify(e.objson),
                        s = { action: "StoreDiagnosticJson", ProgressID: e.ProgressID, DiagnosticOutcome: o };
                    t.ajax({ type: "POST", url: e.TrackURL, data: s, dataType: String }), (e.AssessAttempted = !1);
                }
            }),
            (e.SubmitPLAssessOutcome = function (o) {
                if (!0 === e.AssessAttempted) {
                    var s = { action: "StoreASPAssessNoSession", CandidateID: e.CandidateID, CustomisationID: e.CustomisationID, Version: e.Version, SectionID: e.SectionID, Score: parseInt(o, 10) };
                    t.ajax({ type: "POST", url: e.TrackURL, data: s, dataType: String }), (e.AssessAttempted = !1);
                }
            }),
            "learn" !== e.ContentType)
        ) {
            (e.AssessAttempted = !1),
                (e.OutcomeAnimation = 0),
                (objlist = getp("objlist")),
                (objlist = objlist.replace("[", "")),
                (objlist = objlist.replace("]", "")),
                (e.ObjList = objlist.split(",")),
                history.pushState(null, null, document.title),
                window.addEventListener("popstate", function () {
                    history.pushState(null, null, document.title);
                });
            var s = !1;
            "pl" === e.ContentType && (s = !0);
            var r = { action: "GetObjectiveArrayCC", CustomisationID: e.CustomisationID, SectionID: e.SectionID, IsPostLearning: s };
            t.ajax({
                type: "GET",
                url: e.TrackURL,
                data: r,
                success: function (o, s, r) {
                    e.objson = o.objectives;
                    var n = new Array();
                    t.each(e.objson, function (o, s) {
                        d = !0;
                        var r = s.tutorialid;
                        t.each(e.ObjList, function (e, t) {
                            t == r && (d = !1);
                        }),
                            d && n.push(o);
                    }),
                        t.each(n.reverse(), function (t, o) {
                            e.objson.splice(o, 1);
                        });
                },
                error: function (e, t, o) {
                    alert(e + "     " + o);
                },
            });
        }
    })((window.CCPlayer = window.CCPlayer || {}), jQuery),
    (jQuery.fn.reverse = [].reverse);
